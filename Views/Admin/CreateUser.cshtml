@model OKNODOM.Models.Пользователи
@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Добавить пользователя";
    var roles = ViewBag.Roles as List<OKNODOM.Models.Роли> ?? new();
}


    <div class="header-action-row">
        <h3 class="dashboard-title">Добавить пользователя</h3>
        <a asp-action="Users" class="action-btn primary">← Назад к списку</a>
    </div>

    <div class="order-form-box">
        <form asp-action="CreateUser" method="post">
            <div asp-validation-summary="ModelOnly" class="alert alert-error"></div>

            <div class="form-group">
                <label class="form-label">Фамилия *</label>
                <input asp-for="Фамилия" class="form-input" required />
                <span asp-validation-for="Фамилия" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="form-label">Имя *</label>
                <input asp-for="Имя" class="form-input" required />
                <span asp-validation-for="Имя" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="form-label">Отчество</label>
                <input asp-for="Отчество" class="form-input" />
            </div>

            <div class="form-group">
                <label class="form-label">Логин *</label>
                <input asp-for="Логин" class="form-input" required />
                <span asp-validation-for="Логин" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="form-label">Пароль *</label>
                <input asp-for="Пароль" type="password" class="form-input" required />
                <span asp-validation-for="Пароль" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="form-label">Телефон *</label>
                <input asp-for="Телефон" class="form-input" required />
                <span asp-validation-for="Телефон" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="form-label">Роль *</label>
                <select asp-for="КодРоли" class="form-input" required id="roleSelect">
                    <!-- Добавить id="roleSelect" -->
                    @foreach (var role in roles)
                    {
                        <option value="@role.КодРоли">@role.Название</option>
                    }
                </select>
                <span asp-validation-for="КодРоли" class="text-danger"></span>
            </div>
            <div class="form-group" id="passportFieldGroup" style="display: none;">
                <label class="form-label">Паспорт *</label>
                <input asp-for="Паспорт" class="form-input" id="passportInput" />
                <span asp-validation-for="Паспорт" class="text-danger"></span>
                <small class="text-muted">Обязательно для заполнения для сотрудников</small>
            </div>
            <div class="form-group">
                <div class="checkbox-container">
                    <label class="checkbox-label">
                        <input asp-for="Активный" type="checkbox" class="checkbox-input" />
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text">Активный</span>
                    </label>
                </div>
            </div>

            <div class="form-group" style="margin-top: 30px;">
                <button type="submit" class="main-cta-button" style="width: 100%;">Создать пользователя</button>
            </div>
        </form>
    </div>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const roleSelect = document.getElementById('roleSelect');
            const passportFieldGroup = document.getElementById('passportFieldGroup');
            const passportInput = document.getElementById('passportInput');
            const CLIENT_ROLE_ID = 5; // Тут та же константа

            function togglePassportField() {
                const selectedRoleId = parseInt(roleSelect.value);

                if (selectedRoleId === CLIENT_ROLE_ID) {
                    // Клиент - скрываем поле
                    passportFieldGroup.style.display = 'none';
                    passportInput.removeAttribute('required');
                    passportInput.value = '';
                } else if (selectedRoleId) {
                    // Не клиент - показываем поле
                    passportFieldGroup.style.display = 'block';
                    passportInput.setAttribute('required', 'required');
                } else {
                    // Роль не выбрана
                    passportFieldGroup.style.display = 'none';
                    passportInput.removeAttribute('required');
                }
            }

            roleSelect.addEventListener('change', togglePassportField);
            togglePassportField(); // Вызываем при загрузке
        });
    </script>
}